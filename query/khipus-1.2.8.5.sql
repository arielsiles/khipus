--Khipus MRP PROD-83: Implementar el re procesado de productos
--Diego H. Loza Fernandez
ALTER TABLE ORDENMATERIAL
ADD (IDPRODUCTOREPROCESADO  NUMBER(24) NULL);
ALTER TABLE ORDENMATERIAL
ADD CONSTRAINT FK_ORDENMAT_PRODREPRO FOREIGN KEY ();
ALTER TABLE ORDENINSUMO
ADD (IDPRODUCTOREPROCESADO  NUMBER(24) NULL);

CREATE TABLE REPROCESADO(	
  IDREPROCESADO NUMBER(24,0) NOT NULL, 
	UNIDADES NUMBER(6,0) NULL, 
	VOLUMEN NUMBER(8,2) NULL, 
	IDPLANIFICACIONPRODUCCION NUMBER(24,0) NOT NULL, 
	IDMETAPRODUCTOPRODUCCION NUMBER(24,0) NOT NULL, 
	IDCOMPANIA NUMBER(24,0) NOT NULL,
  CONSTRAINT PK_REPROCESADO PRIMARY KEY(IDREPROCESADO)
);

ALTER TABLE REPROCESADO ADD CONSTRAINT FK_METAPROD_REPROC FOREIGN KEY (IDMETAPRODUCTOPRODUCCION)
	  REFERENCES METAPRODUCTOPRODUCCION (IDMETAPRODUCTOPRODUCCION) ENABLE;
 
ALTER TABLE REPROCESADO ADD CONSTRAINT FK_ORDENPRO_REPROC FOREIGN KEY (IDORDENPRODUCCION)
	  REFERENCES ORDENPRODUCCION (IDORDENPRODUCCION) ENABLE;
--DROP TABLE REPROCESADO    

CREATE TABLE PRODUCTOREPROCESADO(
  IDPRODUCTOREPROCESADO  NUMBER(24) NOT NULL
  ,CANTIDAD NUMBER(6) NULL
  ,IDREPROCESADO NUMBER(24) NULL
  ,IDMETAPRODUCTOPRODUCCION NUMBER(24) NULL
  ,IDCOMPANIA NUMBER(24) NOT  NULL
  ,CONSTRAINT PK_PRODUCTOREPROCESADO PRIMARY KEY(IDPRODUCTOREPROCESADO)
);
--drop TABLE PRODUCTOREPROCESADO
ALTER TABLE PRODUCTOREPROCESADO 
ADD CONSTRAINT FK_REPROC_PRODUCTRE 
FOREIGN KEY(IDREPROCESADO) REFERENCES REPROCESADO(IDREPROCESADO);

ALTER TABLE PRODUCTOREPROCESADO
ADD CONSTRAINT FK_METAPROD_PRODREPROC 
FOREIGN KEY(IDMETAPRODUCTOPRODUCCION) REFERENCES METAPRODUCTOPRODUCCION(IDMETAPRODUCTOPRODUCCION);
--commit
