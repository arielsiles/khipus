<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:app="http://encens.com/products/khipus/facelets"
                template="/layout/template.xhtml">
<ui:define name="pageTitle">
    <c:choose>
        <c:when test="#{productionPlanningAction.managed}">
            #{messages['ProductionPlanning.edit']}
        </c:when>
        <c:otherwise>
            #{messages['ProductionPlanning.new']}
        </c:otherwise>
    </c:choose>
</ui:define>
<ui:param name="bodyWidth" value="100%"/>
<ui:param name="selectedTab" value="products"/>
<ui:define name="body">
<style type="text/css">
    .top-aligned {
        vertical-align: top;
    }
</style>
<h:form id="productionPlanningForm">


<div class="buttons">
    <s:div id="ruleBotton1">

        <h:commandButton
                action="#{productionPlanningReportAction.generateReport(productionPlanningAction.consolidatedInputs,productionPlanning,productionPlanning.productionOrderList)}"
                value="#{messages['ProductionPlanning.generateDocumnt']}"
                styleClass="button"
                rendered="#{productionPlanningAction.managed}"
                tabindex="1"/>

        <!--<h:commandButton action="#{productionPlanningAction.makeFinalized}"
                         value="#{messages['ProductionPlanning.makeFinalized']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'EXECUTED' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                         tabindex="3"/>
        <h:commandButton action="#{productionPlanningAction.makeExecuted}"
                         value="#{messages['ProductionPlanning.makeExecuted']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                         tabindex="3"/>
-->
        <h:commandButton action="#{productionPlanningAction.create(productionPlanningAction.consolidatedInputs)}" value="#{messages['Common.save']}"
                         styleClass="button"
                         rendered="#{!productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','CREATE')}"
                         tabindex="2">
            <s:defaultAction/>
        </h:commandButton>
        <!--<h:commandButton action="#{productionPlanningAction.update}" value="#{messages['Common.update']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                         tabindex="2"/>-->
        <h:commandButton value="#{messages['ProductionPlanning.deletePlannigDay']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING'  and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','DELETE')}"
                         tabindex="3">
            <rich:componentControl for="deleteConfirmation" event="onclick" disableDefault="true" operation="show"/>
        </h:commandButton>

        <h:commandButton action="#{productionPlanningAction.cancel}" value="#{messages['Common.back']}"
                         styleClass="button" immediate="true"
                         tabindex="4">
        </h:commandButton>
    </s:div>
</div>

<rich:panel id="productionPlanningPanel">
<f:facet name="header">
    <c:choose>
        <c:when test="#{productionPlanningAction.managed}">
            #{messages['ProductionPlanning.edit']}
        </c:when>
        <c:otherwise>
            #{messages['ProductionPlanning.new']}
        </c:otherwise>
    </c:choose>
</f:facet>
<h:panelGrid columns="2" width="100%">
    <s:decorate id="dateField" template="/include/inputField.xhtml" styleClass="formRow">
        <ui:define name="label">#{messages['ProductionPlanning.date']}</ui:define>
        <rich:calendar id="date" value="#{productionPlanning.date}" required="true"
                       readonly="#{productionOrderForPlanning.estateOrder eq 'EXECUTED'}">
            <a4j:support event="onchange"/>
        </rich:calendar>
    </s:decorate>
    <!--    <h:outputText
style="font-weight: bold; font-size:1.2em; color: #{productionOrderForPlanning.estateOrder == 'PENDING' ? 'red' :(productionOrderForPlanning.estateOrder == 'EXECUTED' ? 'blue' : 'green')}"
value="#{productionOrderForPlanning.estateOrder == 'PENDING' ? messages['productionOrderForPlanning.estateOrder.pending'] : (productionOrderForPlanning.estateOrder == 'EXECUTED' ? messages['productionOrderForPlanning.estateOrder.executed'] : messages['productionOrderForPlanning.estateOrder.finalized'])}"/>-->
</h:panelGrid>

<rich:separator/>
<br/>
<h:panelGroup id="formulaSet">
<a4j:commandButton id="editFormulaButton" value="#{messages['ProductionPlanning.editFormulaButton']}"
                   action="#{productionPlanningAction.initEditFormula}"
                   reRender="formulaSet,containerCreateButton,ruleBotton2,ruleBotton1"
                   rendered="#{(productionOrderForPlanning.estateOrder eq 'PENDING' or productionOrderForPlanning.estateOrder eq 'EXECUTED') and productionPlanningAction.formulaState eq 'NONE' and !(productionPlanningAction.addMaterial) and !(productionPlanningAction.showDetailOrder)}"
                   ajaxSingle="true"/>

<a4j:region>
    <h:panelGrid columns="2" width="100%"
                 rendered="#{!(productionPlanningAction.formulaState eq 'NONE') and productionOrderForPlanning.estateOrder eq 'PENDING' and !(productionPlanningAction.addMaterial)}">
        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionOrder.order']}</ui:define>
            <h:inputText value="#{productionOrderForPlanning.code}"
                         required="false" readonly="true" maxlength="500" styleClass="input" tabindex="5">
            </h:inputText>
        </s:decorate>
        <s:decorate id="processedProductField" template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionPlanning.processedProduct']}</ui:define>
            <h:inputText id="processedProduct" value="#{processedProductForPlanning.fullName}"
                         required="true" maxlength="500" styleClass="input" tabindex="5"
                         disabled="#{productionOrderForPlanning.estateOrder eq 'EXECUTED'}">
            </h:inputText>
            <a4j:commandLink id="selectProcessedProduct" ajaxSingle="true" immediate="true"
                             tabindex="2"
                             title="#{messages['ProductionPlanning.selectProcessedProduct']}"
                             onclick="Richfaces.showModalPanel('processedProductListModalPanel');"
                             rendered="#{productionPlanningAction.formulaState eq 'NEW' and productionOrderForPlanning.estateOrder != 'EXECUTED'}">
                <h:graphicImage value="/img/search.jpg" styleClass="select-image-middle"/>
            </a4j:commandLink>
        </s:decorate>
        <s:decorate id="productCompositionField" template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionPlanning.productComposition']}</ui:define>
            <h:selectOneMenu id="productComposition" value="#{productionPlanningAction.productComposition}"
                             styleClass="input" tabindex="6"
                             required="true"
                             disabled="#{productionOrderForPlanning.estateOrder eq 'EXECUTED'}">
                <s:selectItems value="#{productionPlanningAction.productCompositionList}"
                               var="productCompositionItem"
                               label="#{productCompositionItem.name}"
                               noSelectionLabel="" hideNoSelectionLabel="false"/>
                <s:convertEntity/>
                <a4j:support ajaxSingle="true" event="onchange" reRender="formulaSet"
                             actionListener="#{productionPlanningAction.productCompositionSelected}"/>
            </h:selectOneMenu>
        </s:decorate>
        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionPlanning.espendingAmount']}</ui:define>
            <h:inputText value="#{productionOrderForPlanning.expendAmount}"
                         required="true" styleClass="input" tabindex="5"
                         disabled="#{productionOrderForPlanning.estateOrder eq 'EXECUTED'}">
                <a4j:support event="onblur" ajaxSingle="false" reRender="formulaSet"
                             actionListener="#{productionPlanningAction.evaluateExpressionActionListener}"/>
            </h:inputText>
        </s:decorate>

        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionPlanning.containerWeight']}</ui:define>
            <h:inputText value="#{productionOrderForPlanning.containerWeight}"
                         required="false" styleClass="input" tabindex="5" readonly="true"/>
        </s:decorate>

        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionPlanning.totalWeight']}</ui:define>
            <h:inputText value="#{productionPlanningAction.totalWeight}"
                         required="false" styleClass="input" tabindex="5" readonly="true">
                <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
            </h:inputText>
        </s:decorate>
    </h:panelGrid>
    <s:div rendered="#{!(productionPlanningAction.formulaState eq 'NONE') and productionOrderForPlanning.estateOrder eq 'PENDING'}">
        <table style="width:100%">
            <tr>
                <td style="width:70%">
                    <rich:dataTable value="#{productionOrderForPlanning.orderInputs}"
                                    var="productionIngredientItem"
                                    id="productionIngredientList" styleClass="formRow" width="100%">
                        <f:facet name="header">
                            <rich:columnGroup>
                                <rich:column>
                                    #{messages['ProductionPlanning.inputName']}
                                </rich:column>
                                <rich:column>
                                    #{messages['ProductionOrder.productionInput.measureUnit']}
                                </rich:column>
                                <rich:column>
                                    #{messages['ProductionPlanning.inputAmount']}
                                </rich:column>
                                <rich:column>
                                    #{messages['ProductionOrder.productionInput.amountWareHouse']}
                                </rich:column>
                            </rich:columnGroup>
                        </f:facet>
                        <rich:column>
                            <h:outputText value="#{productionIngredientItem.productItem.name}"/>
                        </rich:column>
                        <rich:column>
                            <h:outputText value="#{productionIngredientItem.productItem.usageMeasureCode}"/>
                        </rich:column>
                        <rich:column>
                            <h:inputText value="#{productionIngredientItem.amount}"
                                         styleClass="input"
                                         disabled="#{!productionPlanningAction.isParameterized(productionIngredientItem.productItem)}">
                                <a4j:support event="onblur" ajaxSingle="false" reRender="formulaSet"
                                                 actionListener="#{productionPlanningAction.evaluateParameterizedExpressionActionListener(productionIngredientItem)}"/>
                            </h:inputText>
                        </rich:column>
                        <rich:column
                                styleClass="#{productionPlanningAction.verifAmountInput(productionIngredientItem)?'labelInfo':'labelAlarm'}">
                            <h:outputText value="#{productionIngredientItem.amountStock}">
                                <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                            </h:outputText>
                        </rich:column>

                    </rich:dataTable>
                </td>
                <td style="width:30%; vertical-align: bottom; text-align: right;">
                    <s:div>
                        <a4j:commandButton id="addInnerButton" action="#{productionPlanningAction.addFormulation}"
                                           value="#{messages['ProductionPlanning.innerButtonAdd']}"
                                           reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"
                                           rendered="#{productionPlanningAction.formulaState eq 'NEW' and productionOrderForPlanning.estateOrder != 'EXECUTED' and productionPlanningAction.dispobleBalance}"/>

                        <!--<a4j:commandButton id="createInnerButton" action="#{productionPlanningAction.create(productionPlanningAction.consolidatedInputs)}" value="#{messages['Common.save']}"
                                         styleClass="button"
                                         rendered="#{ !productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','CREATE')}">
                            <s:defaultAction/>
                        </a4j:commandButton>-->

                        <a4j:commandButton id="updateInnerButton" action="#{productionPlanningAction.updateFormulation}"
                                           value="#{messages['ProductionPlanning.innerButtonUpdate']}"
                                           reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"
                                           rendered="#{productionPlanningAction.formulaState eq 'EDIT' and productionOrderForPlanning.estateOrder != 'EXECUTED' and productionPlanningAction.dispobleBalance}"/>
                        <a4j:commandButton
                                           value="#{messages['ProductionPlanning.innerButtonRemove']}"
                                           reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"
                                           rendered="#{productionPlanningAction.formulaState eq 'EDIT' and productionOrderForPlanning.estateOrder != 'EXECUTED'}">
                            <rich:componentControl for="deleteOrderConfirmation" event="onclick" disableDefault="true" operation="show"/>
                        </a4j:commandButton>
                        <a4j:commandButton id="cancelInnerButton" action="#{productionPlanningAction.cancelFormulation}"
                                           ajaxSingle="true"
                                           value="#{messages['ProductionPlanning.innerButtonCancel']}"
                                           reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"/>
                    </s:div>
                </td>
            </tr>
        </table>
    </s:div>
</a4j:region>

<a4j:region rendered="#{productionPlanningAction.showDetailOrder}">
    <!--region detalle Orden de produccion-->
    <app:fieldset id="orderDetail" title="#{messages['ProductionOrder.processedProduct.detail']}">
        <h:panelGrid columns="3"
                     width="100%"
                     cellpadding="0"
                     cellspacing="0"
                     border="0"
                     columnClasses="width50percent, width50percent">

            <s:div>
                <s:decorate id="materialProductNameField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.processedProduct.name'] }</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.productComposition.processedProduct.name}"/>
                </s:decorate>

                <s:decorate id="materialCodeField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.processedProduct.code']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.productComposition.processedProduct.code}"/>
                </s:decorate>

                <s:decorate id="materialOrderField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.order']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.code}"/>
                </s:decorate>

                <s:decorate id="materialSuppAmountField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.expectedAmount']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.expendAmount}">
                        <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                    </h:outputText>
                </s:decorate>

                <s:decorate id="estateOrderField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.estateOrder']}</ui:define>
                    <h:outputText
                            style="font-weight: bold; font-size:1.2em; color: #{productionOrderForPlanning.estateOrder == 'PENDING' ? 'red' :(productionOrderForPlanning.estateOrder == 'EXECUTED' ? 'blue' : 'green')}"
                            value="#{productionOrderForPlanning.estateOrder == 'PENDING' ? messages['productionOrderForPlanning.estateOrder.pending'] : (productionOrderForPlanning.estateOrder == 'EXECUTED' ? messages['productionOrderForPlanning.estateOrder.executed'] : messages['productionOrderForPlanning.estateOrder.finalized'])}"/>
                </s:decorate>

            </s:div>

            <s:div>
                <s:decorate id="producingAmountField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.processedProduct.amountObtained'] }</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.producedAmount}">
                        <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                    </h:outputText>
                </s:decorate>

                <s:decorate id="totalPriceMaterialField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.totalPriceMaterial']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.totalPriceMaterial}">
                        <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                    </h:outputText>
                </s:decorate>

                <s:decorate id="totalPriceInputField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.totalPriceInput']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.totalPriceInput}">
                        <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                    </h:outputText>
                </s:decorate>

                <s:decorate id="totalPriceJourneyField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.totalPriceJourney']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.totalPriceJourney}">
                        <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                    </h:outputText>
                </s:decorate>

                <s:decorate id="totalCostProductionField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.totalCostProduction']}</ui:define>
                    <h:outputText value="#{productionOrderForPlanning.totalCostProduction}">
                        <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                    </h:outputText>
                </s:decorate>

                <s:decorate id="unitCostMaterialField" template="/include/inputField.xhtml" styleClass="formRow">
                    <ui:define name="label">#{messages['ProductionOrder.costPriceObtained']}</ui:define>
                    <h:outputText
                            value="#{productionOrderForPlanning.productComposition.processedProduct.productItem.unitCost}"/>
                </s:decorate>
            </s:div>

            <s:div>
                <a4j:commandButton action="#{productionPlanningAction.makeFinalizedOrder}"
                                   value="#{messages['ProductionPlanning.makeFinalized']}"
                                   styleClass="button"
                                   rendered="#{productionOrderForPlanning.estateOrder eq 'EXECUTED' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                                   tabindex="2"/>
                <a4j:commandButton action="#{productionPlanningAction.makeExecutedOrder}"
                                   value="#{messages['ProductionPlanning.makeExecuted']}"
                                   styleClass="button"
                                   rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                                   tabindex="2"/>
                <a4j:commandButton action="#{productionPlanningAction.closeDetail}" ajaxSingle="true"
                                   value="#{messages['ProductionPlanning.innerButtonCancelDetail']}"
                                   reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"/>
                <h:commandButton
                        action="#{productionPlanningReportAction.generateReportByOrder(productionOrderForPlanning.productComposition.productionIngredientList,productionOrderForPlanning.orderInputs,productionOrderForPlanning.orderMaterials,productionPlanning,productionOrderForPlanning)}"
                        value="#{messages['ProductionPlanning.generateOrderDocumnt']}"
                        styleClass="button"
                        rendered="#{productionPlanningAction.managed}"
                        tabindex="1"/>

                <h:commandButton
                        action="#{productionPlanningReportAction.generateReportSummary(productionOrderForPlanning.productComposition.productionIngredientList,productionOrderForPlanning.orderInputs,productionOrderForPlanning.orderMaterials,productionPlanning,productionOrderForPlanning,productionOrderForPlanning.productComposition.processedProduct.productItem.unitCost)}"
                        value="#{messages['ProductionPlanning.generateSummaryDocumnt']}"
                        styleClass="button"
                        rendered="#{productionPlanningAction.managed}"
                        tabindex="1"/>

            </s:div>

        </h:panelGrid>
    </app:fieldset>
    <!--region detalle Insumos-->
    <app:fieldset id="inputDetailProducts" title="#{messages['MovementDetail.detailInput']}">
        <rich:dataTable value="#{productionOrderForPlanning.orderInputs}"
                        var="inputProductionItem"
                        id="productionIngredientDetailList" styleClass="formRow" width="100%">
            <f:facet name="header">
                <rich:columnGroup>
                    <rich:column>
                        #{messages['ProductionPlanning.inputName']}
                    </rich:column>
                    <rich:column>
                        #{messages['ProductionOrder.productionInput.measureUnit']}
                    </rich:column>
                    <rich:column>
                        #{messages['ProductionPlanning.inputAmount']}
                    </rich:column>
                    <rich:column>
                        #{messages['ProductionOrder.unitPriceCost']}
                    </rich:column>
                    <rich:column>
                        #{messages['ProductionOrder.costTotal']}
                    </rich:column>
                </rich:columnGroup>
            </f:facet>

            <rich:column>
                <h:outputText value="#{inputProductionItem.productItem.name}"/>
            </rich:column>

            <rich:column>
                <h:outputText value="#{inputProductionItem.productItem.usageMeasureCode}"/>
            </rich:column>

            <rich:column>
                <h:outputText value="#{inputProductionItem.amount}">
                    <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

            <rich:column>
                <h:outputText value="#{inputProductionItem.costUnit}">
                    <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

            <rich:column>
                <h:outputText value="#{inputProductionItem.costTotal}">
                    <f:convertNumber pattern="#{messages['patterns.decimalNumber']}"/>
                </h:outputText>
            </rich:column>

        </rich:dataTable>
    </app:fieldset>
    <!--region detalle Materiales-->
    <app:fieldset id="materialDetailProducts" title="#{messages['MovementDetail.detailMaterial']}">
        <h:panelGrid columns="1"
                     width="100%"
                     cellpadding="0"
                     cellspacing="0"
                     border="0">
            <s:div id="materialDetailListPanel">

                <table cellpadding="0" cellspacing="0" border="0" width="100%" class="rich-table">
                    <thead class="rich-table-thead">
                    <tr class="rich-table-header">
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.productItem']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.measureUnit']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.amountRequired']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.amountUsed']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.amountReturn']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.priceCost']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.priceCostTotal']}
                        </th>
                    </tr>
                    </thead>

                    <c:forEach var="instance" items="#{productionOrderForPlanning.orderMaterials}" varStatus="row">
                        <c:set var="amountRequiredId" value="quantityField_#{row.index}"/>

                        <tr class="rich-table-row">
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.productItem.fullName}"/>
                            </td>
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.productItem.usageMeasureUnit.name}"/>
                            </td>
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.amountRequired}"/>
                            </td>
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.amountUsed}"/>
                            </td>
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.amountReturned}"/>
                            </td>
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.costUnit}"/>
                            </td>

                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.costTotal}"/>
                            </td>
                        </tr>

                    </c:forEach>
                </table>
            </s:div>
        </h:panelGrid>
    </app:fieldset>
</a4j:region>
<!--fin region detalle Materiales-->
<!--Agregar Materiales-->
<a4j:region rendered="#{productionPlanningAction.addMaterial}">
    <!--Detalle del producto-->
    <app:fieldset id="productDetailFields" title="#{messages['ProductionOrder.processedProduct.detail']}">
        <h:panelGrid columns="1"
                     width="100%"
                     cellpadding="0"
                     cellspacing="0"
                     border="0"
                     columnClasses="width50percent, width50percent">

            <s:decorate id="processedProductNameField" template="/include/inputField.xhtml" styleClass="formRow">
                <ui:define name="label">#{messages['ProductionOrder.processedProduct.name'] }</ui:define>
                <h:outputText value="#{productionOrderMaterialForPlanning.productComposition.processedProduct.name}"/>
            </s:decorate>

            <s:decorate id="processedProductCodeField" template="/include/inputField.xhtml" styleClass="formRow">
                <ui:define name="label">#{messages['ProductionOrder.processedProduct.code']}</ui:define>
                <h:outputText value="#{productionOrderMaterialForPlanning.productComposition.processedProduct.code}"/>
            </s:decorate>

            <s:decorate id="processedProductOrderField" template="/include/inputField.xhtml" styleClass="formRow">
                <ui:define name="label">#{messages['ProductionOrder.order']}</ui:define>
                <h:outputText value="#{productionOrderMaterialForPlanning.code}"/>
            </s:decorate>

            <s:decorate id="processedProductSuppAmountField" template="/include/inputField.xhtml" styleClass="formRow">
                <ui:define name="label">#{messages['ProductionOrder.expectedAmount']}</ui:define>
                <h:outputText value="#{productionOrderMaterialForPlanning.expendAmount}"/>
            </s:decorate>

            <s:decorate id="estateField" template="/include/inputField.xhtml" styleClass="formRow">
                <ui:define name="label">#{messages['ProductionOrder.estateOrder']}</ui:define>
                <h:outputText
                        style="font-weight: bold; font-size:1.2em; color: #{productionOrderForPlanning.estateOrder == 'PENDING' ? 'red' :(productionOrderForPlanning.estateOrder == 'EXECUTED' ? 'blue' : 'green')}"
                        value="#{productionOrderForPlanning.estateOrder == 'PENDING' ? messages['productionOrderForPlanning.estateOrder.pending'] : (productionOrderForPlanning.estateOrder == 'EXECUTED' ? messages['productionOrderForPlanning.estateOrder.executed'] : messages['productionOrderForPlanning.estateOrder.finalized'])}"/>
            </s:decorate>

        </h:panelGrid>
    </app:fieldset>
    <!--Fin Detalle del producto-->
    <!--Detalle de Materiales-->
    <app:fieldset id="movementDetailFields" title="#{messages['ProductionPlanning.detailMaterial']}">
        <h:panelGrid columns="1"
                     width="100%"
                     cellpadding="0"
                     cellspacing="0"
                     border="0">
            <s:div id="movementDetailListPanel">
                <div class="buttons">

                    <a4j:commandButton action="#{productionPlanningAction.addOrderProduced}"
                                       value="#{messages['ProductionPlanning.materialUpdate']}"
                                       reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"
                                       rendered="#{productionOrderForPlanning.estateOrder eq 'EXECUTED' or productionOrderForPlanning.estateOrder eq 'PENDING'}"
                            />
                    <rich:spacer width="10"/>

                    <a4j:commandButton id="addProductItemCommandButton"
                                       action="#{productItemSearchDataModel.reset()}"
                                       value="#{messages['ProductionPlanning.addMaterial']}"
                                       styleClass="button"
                                       immediate="true"
                                       oncomplete="Richfaces.showModalPanel('productItemsListModalPanel');"
                                       actionListener="#{selectPopUpAction.select}"
                                       rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING'}"
                                       reRender="productItemsListModalPanel">
                        <f:attribute name="entityManagerName" value=""/>
                        <f:attribute name="dataModelObject" value="#{productItemSearchDataModel}"/>
                    </a4j:commandButton>

                    <a4j:commandButton id="cancelMaterialButton" action="#{productionPlanningAction.cancelMaterial}"
                                       ajaxSingle="true"
                                       value="#{messages['ProductionPlanning.innerButtonCancel']}"
                                       reRender="formulaSet,ruleBotton2,ruleBotton1"/>

                </div>

                <table cellpadding="0" cellspacing="0" border="0" width="100%" class="rich-table">
                    <thead class="rich-table-thead">
                    <tr class="rich-table-header">
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.productItem']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.measureUnit']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.amountRequired']}
                        </th>
                        <!--<th class="rich-table-headercell">
                            #{messages['MovementDetail.unitRequired']}
                        </th>-->
                        <th class="rich-table-headercell">
                            #{messages['MovementDetail.amountUsed']}
                        </th>
                        <th class="rich-table-headercell">
                            #{messages['Common.action']}
                        </th>
                    </tr>
                    </thead>

                    <c:forEach var="instance" items="#{productionPlanningAction.orderMaterials}" varStatus="row">
                        <c:set var="amountRequiredId" value="quantityField_#{row.index}"/>

                        <tr class="rich-table-row">
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.productItem.fullName}"/>
                            </td>
                            <td class="rich-table-cell">
                                <h:outputText value="#{instance.productItem.usageMeasureUnit.name}"/>
                            </td>
                            <td class="rich-table-cell center" id="amountRequiredField">
                                <h:inputText value="#{instance.amountRequired}"
                                             maxlength="500" styleClass="input"
                                             required="false"
                                             disabled="#{productionOrderForPlanning.estateOrder eq 'EXECUTED'}">
                                    <a4j:support event="onblur" reRender="amountRequiredField"/>
                                </h:inputText>
                            </td>

                            <!--<td class="rich-table-cell center" id="amountRequiredUnitField">
                                <h:inputText value="#{instance.amountRequiredUnit}"
                                             maxlength="500" styleClass="input"
                                             required="false">
                                    <a4j:support event="onblur" reRender="amountRequiredUnitField"/>
                                </h:inputText>
                            </td>-->

                            <td class="rich-table-cell center" id="amountUsedField">
                                <h:inputText value="#{instance.amountUsed}"
                                             maxlength="500" styleClass="input"
                                             required="false">
                                    <a4j:support event="onblur" reRender="amountUsedField"/>
                                </h:inputText>
                            </td>

                            <td class="rich-table-cell center">
                                <a4j:commandLink immediate="true"
                                                 title="#{messages['Common.remove']}"
                                                 action="#{productionPlanningAction.removeMaterial(instance)}"
                                                 ajaxSingle="true"
                                                 rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING'}"
                                                 reRender="movementDetailListPanel">
                                    <h:graphicImage value="/img/clear.jpg" styleClass="select-image-middle"/>
                                </a4j:commandLink>
                            </td>

                        </tr>
                    </c:forEach>
                </table>
            </s:div>
        </h:panelGrid>
    </app:fieldset>
    <!--Detalle de Materiales-->
</a4j:region>
<!--Fin Agregar Materiales-->

<a4j:region>
    <h:panelGrid columns="3" columnClasses="top-aligned,top-aligned,top-aligned" width="100%"
                 rendered="#{productionPlanningAction.formulaState eq 'EDIT' and productionOrderForPlanning.estateOrder != 'PENDING'}">
        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionOrder.order']}</ui:define>
            <h:outputText value="#{productionOrderForPlanning.productComposition.processedProduct.name}"
                    >
            </h:outputText>
        </s:decorate>
        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionOrder.productComposition.name']}</ui:define>
            <h:outputText value="#{productCompositionForPlanning.name}"
                    >
            </h:outputText>
        </s:decorate>
        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionOrder.expectedAmount']}</ui:define>
            <h:outputText value="#{productionOrderForPlanning.expendAmount}">
            </h:outputText>
        </s:decorate>
        <s:decorate id="estateOrdField" template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">#{messages['ProductionOrder.estateOrder']}</ui:define>
            <h:outputText
                    style="font-weight: bold; font-size:1.2em; color: #{productionOrderForPlanning.estateOrder == 'PENDING' ? 'red' :(productionOrderForPlanning.estateOrder == 'EXECUTED' ? 'blue' : 'green')}"
                    value="#{productionOrderForPlanning.estateOrder == 'PENDING' ? messages['productionOrderForPlanning.estateOrder.pending'] : (productionOrderForPlanning.estateOrder == 'EXECUTED' ? messages['productionOrderForPlanning.estateOrder.executed'] : messages['productionOrderForPlanning.estateOrder.finalized'])}"/>
        </s:decorate>
        <s:decorate template="/include/inputField.xhtml" styleClass="formRow">
            <ui:define name="label">Cantidad Producida:</ui:define>
            <h:inputText value="#{productionOrderForPlanning.producedAmount}"
                         required="false" readonly="false" maxlength="500" styleClass="input">
            </h:inputText>
        </s:decorate>
        <s:div>
            <a4j:commandButton action="#{productionPlanningAction.updateProducedAmount}"
                               value="#{messages['ProductionPlanning.innerButtonUpdate']}"
                               reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"
                               rendered="#{productionOrderForPlanning.estateOrder == 'EXECUTED'}"/>
            <rich:spacer width="10"/>
            <a4j:commandButton action="#{productionPlanningAction.cancelFormulation}" ajaxSingle="true"
                               value="#{messages['ProductionPlanning.innerButtonCancel']}"
                               reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"/>
        </s:div>
    </h:panelGrid>

</a4j:region>
</h:panelGroup>
</rich:panel>


<h:panelGrid id="productionList" columns="2" columnClasses="top-aligned" width="100%">
    <rich:dataTable value="#{productionPlanning.productionOrderList}" var="productionOrderItem" id="productionOrderList"
                    width="100%">
        <f:facet name="header">
            <rich:columnGroup>
                <rich:column>
                    #{messages['ProductionOrder.processedProduct.name']}
                </rich:column>
                <rich:column>
                    #{messages['ProductionOrder.processedProduct.code']}
                </rich:column>
                <rich:column>
                    #{messages['ProductionOrder.order']}
                </rich:column>
                <rich:column>
                    #{messages['ProductionOrder.formula']}
                </rich:column>
                <rich:column>
                    #{messages['ProductionOrder.expectedAmount']}
                </rich:column>
                <rich:column>
                    #{messages['ProductionOrder.producingAmount']}
                </rich:column>
                <rich:column>
                    #{messages['ProductionOrder.estateOrderProduction']}
                </rich:column>
                <rich:column styleClass="center">
                    #{messages['Common.action']}
                </rich:column>
            </rich:columnGroup>
        </f:facet>
        <rich:column>
            <h:outputText value="#{productionOrderItem.productComposition.processedProduct.name}"/>
        </rich:column>
        <rich:column>
            <h:outputText value="#{productionOrderItem.productComposition.processedProduct.code}"/>
        </rich:column>
        <rich:column>
            <h:outputText value="#{productionOrderItem.code}"/>
        </rich:column>
        <rich:column>
            <h:outputText value="#{productionOrderItem.productComposition.name}"/>
        </rich:column>
        <rich:column>
            <h:outputText value="#{productionOrderItem.expendAmount}"/>
        </rich:column>
        <rich:column>
            <h:outputText value="#{productionOrderItem.producedAmount}"/>
        </rich:column>
        <rich:column>
            <h:outputText
                    style="font-weight: bold; font-size:1.2em; color: #{productionOrderItem.estateOrder == 'PENDING' ? 'red' :(productionOrderItem.estateOrder == 'EXECUTED' ? 'blue' : 'green')}"
                    value="#{productionOrderItem.estateOrder == 'PENDING' ? messages['productionOrderForPlanning.estateOrder.pending'] : (productionOrderItem.estateOrder == 'EXECUTED' ? messages['productionOrderForPlanning.estateOrder.executed'] : messages['productionOrderForPlanning.estateOrder.finalized'])}"/>
        </rich:column>
        <rich:column styleClass="center">

            <a4j:commandLink ajaxSingle="true" immediate="true"
                             value="#{ productionOrderItem.estateOrder == 'PENDING' ? messages['ProductionOrder.materialProduccion.addInput']:messages['ProductionOrder.materialProduccion.modifyInputMount']}"
                             action="#{productionPlanningAction.select(productionOrderItem)}"
                             rendered="#{productionOrderItem.estateOrder == 'EXECUTED' or productionOrderItem.estateOrder == 'PENDING'}"
                             reRender="formulaSet,ruleBotton2,ruleBotton1"/>
            <rich:spacer width="5"/>

            <a4j:commandLink ajaxSingle="true" immediate="true"
                             value="#{productionOrderItem.estateOrder == 'PENDING' ? messages['ProductionOrder.materialProduccion.addMaterial']: messages['ProductionOrder.materialProduccion.setMountUsed']}"
                             action="#{productionPlanningAction.selectMaterial(productionOrderItem)}"
                             rendered="#{productionOrderItem.estateOrder == 'EXECUTED' or productionOrderItem.estateOrder == 'PENDING'}"
                             reRender="formulaSet,ruleBotton2,ruleBotton1"/>
            <rich:spacer width="5"/>
            <!--MOSTRAR OPCION DETALLE MATERIAL-->
            <!--   <c:if test="#{productionOrderForPlanning.estateOrder == 'FINALIZED' or productionOrderForPlanning.estateOrder == 'EXECUTED'}">
                <a4j:commandLink ajaxSingle="true" immediate="true" value="#{messages['ProductionOrder.materialProduccion.detailOrder']}"
                                 action="#{productionPlanningAction.selectMaterialDetail(productionOrderItem)}"
                                 reRender="formulaSet,ruleBotton2,ruleBotton1"/>
            </c:if>-->
            <!--MOSTRAR OPCION DETALLE MATERIAL-->

            <a4j:commandLink ajaxSingle="true" immediate="true"
                             value="#{messages['ProductionOrder.materialProduccion.selectOrder']}"
                             action="#{productionPlanningAction.selectDetail(productionOrderItem)}"
                             reRender="formulaSet,ruleBotton2,ruleBotton1"/>

            <!--<rich:spacer width="5"/>
            &lt;!&ndash;MOSTRAR OPCION DETALLE INSUMO&ndash;&gt;
            <c:if test="#{productionOrderForPlanning.estateOrder == 'FINALIZED' or productionOrderForPlanning.estateOrder == 'EXECUTED'}">
                <a4j:commandLink ajaxSingle="true" immediate="true" value="#{messages['ProductionOrder.materialProduccion.detailInput']}"
                                 action="#{productionPlanningAction.selectInputDetail(productionOrderItem)}"
                                 reRender="formulaSet,ruleBotton2,ruleBotton1"/>
            </c:if>-->
        </rich:column>
    </rich:dataTable>

</h:panelGrid>


<div class="buttons">
    <s:div id="ruleBotton2">
        <h:commandButton
                action="#{productionPlanningReportAction.generateReport(productionPlanningAction.consolidatedInputs,productionPlanning)}"
                value="#{messages['ProductionPlanning.generateDocumnt']}"
                rendered="#{productionPlanningAction.managed}"
                styleClass="button"
                tabindex="1"/>

        <!--&lt;!&ndash;<h:commandButton action="#{productionPlanningAction.makeFinalized}"
                         value="#{messages['ProductionPlanning.makeFinalized']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'EXECUTED' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                         tabindex="2"/>
        <h:commandButton action="#{productionPlanningAction.makeExecuted}"
                         value="#{messages['ProductionPlanning.makeExecuted']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                         tabindex="2"/>-->

        <h:commandButton action="#{productionPlanningAction.create(productionPlanningAction.consolidatedInputs)}" value="#{messages['Common.save']}"
                         styleClass="button"
                         rendered="#{!productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','CREATE')}"
                         tabindex="1">
            <s:defaultAction/>
        </h:commandButton>

<!--
        <h:commandButton action="#{productionPlanningAction.update}" value="#{messages['Common.update']}"
                         styleClass="button"
                         rendered="#{productionOrderForPlanning.estateOrder eq 'PENDING' and productionPlanningAction.formulaState eq 'NONE' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','UPDATE')}"
                         tabindex="2"/>
-->
        <h:commandButton value="#{messages['ProductionPlanning.deletePlannigDay']}"
                         styleClass="button"
                         rendered="#{ProductionPlanning.deleteOrder.confirmation.estateOrder eq 'PENDING' and productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','DELETE')}"
                         tabindex="3">
            <rich:componentControl for="deleteConfirmation" event="onclick" disableDefault="true" operation="show"/>
        </h:commandButton>

        <h:commandButton action="#{productionPlanningAction.cancel}" value="#{messages['Common.back']}"
                         styleClass="button" tabindex="21" immediate="true"/>
    </s:div>
</div>
</h:form>

<s:decorate template="/include/modalDialog.xhtml"
            rendered="#{productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','DELETE')}">
    <ui:param name="dialogId" value="deleteOrderConfirmation"/>
    <ui:define name="dialogTitle">#{messages['Common.delete.confirmation']}</ui:define>
    <ui:define name="dialogContent">
        <p>
            <h:outputFormat value="#{messages['ProductionPlanning.deleteOrder.confirmation']}">
                <f:param value="#{productionOrderForPlanning.productComposition.processedProduct.name}"/>
            </h:outputFormat>
        </p>
    </ui:define>
    <ui:define name="dialogOption">
        <a4j:commandButton action="#{productionPlanningAction.removeFormulation}"
                           value="#{messages['Common.delete']}"
                           immediate="true"
                           rendered="#{s:hasPermission('PRODUCTDISTRIBUTION','DELETE')}"
                           reRender="productionList,formulaSet,ruleBotton2,ruleBotton1"
                           styleClass="button"/>
    </ui:define>
</s:decorate>

<s:decorate template="/include/modalDialog.xhtml"
            rendered="#{productionPlanningAction.managed and s:hasPermission('PRODUCTDISTRIBUTION','DELETE')}">
    <ui:param name="dialogId" value="deleteConfirmation"/>
    <ui:define name="dialogTitle">#{messages['Common.delete.confirmation']}</ui:define>
    <ui:define name="dialogContent">
        <p>
            <h:outputFormat value="#{messages['ProductionPlanning.delete.confirmation']}">
                <f:param value="#{productionPlanning.date}"/>
            </h:outputFormat>
        </p>
    </ui:define>
    <ui:define name="dialogOption">
        <a4j:commandButton action="#{productionPlanningAction.delete}"
                           value="#{messages['Common.delete']}"
                           immediate="true"
                           rendered="#{s:hasPermission('PRODUCTDISTRIBUTION','DELETE')}"
                           tabindex="1000"
                           styleClass="button"/>
    </ui:define>
</s:decorate>

<s:decorate id="productItemsListModalPanelContainer"
            template="/warehouse/productItemsListModalPanel.xhtml">
    <ui:param name="containerId" value="productItemsListModalPanelContainer"/>
    <ui:param name="dialogId" value="productItemsListModalPanel"/>
    <ui:define name="addButton">
        <a4j:commandButton id="addButton"
                           immediate="true"
                           ajaxSingle="true"
                           action="#{productionPlanningAction.addProductItems(productItemSearchDataModel.selectedProductItems)}"
                           value="#{messages['Common.add']}"
                           reRender="movementDetailListPanel"
                           styleClass="button"
                           oncomplete="Richfaces.hideModalPanel('productItemsListModalPanel');"/>
    </ui:define>
</s:decorate>

<s:decorate id="processedProductListModalPanelContainer" template="/production/metaProductListModalPanel.xhtml">
    <ui:param name="listTitle" value="#{messages['ProductionPlanning.selectProcessedProduct']}"/>
    <ui:param name="searchPanelTitle" value="#{messages['ProductionPlanning.searchProcessedProduct']}"/>
    <ui:param name="nameSortProperty" value="processedProduct.name"/>
    <ui:param name="codeSortProperty" value="processedProduct.code"/>
    <ui:param name="dialogId" value="processedProductListModalPanel"/>
    <ui:param name="dataModel" value="#{processedProductDataModel}"/>
    <ui:param name="showMeasureUnit" value="false"/>
    <ui:define name="assignButton">
        <a4j:commandButton id="assignButton"
                           title="#{messages['Common.choose']}"
                           action="#{productionPlanningAction.selectProcessedProduct(dataItem)}"
                           image="/img/active.gif"
                           styleClass="select-image-middle"
                           ajaxSingle="true"
                           reRender="productionPlanningPanel"
                           oncomplete="Richfaces.hideModalPanel('processedProductListModalPanel');"
                           style="width:0.8em"/>

    </ui:define>
</s:decorate>

<s:decorate id="secondProcessedProductListModalPanelContainer" template="/production/metaProductListModalPanel.xhtml">
    <ui:param name="listTitle" value="#{messages['ProductionPlanning.selectProcessedProduct']}"/>
    <ui:param name="searchPanelTitle" value="#{messages['ProductionPlanning.searchProcessedProduct']}"/>
    <ui:param name="nameSortProperty" value="processedProduct.name"/>
    <ui:param name="codeSortProperty" value="processedProduct.code"/>
    <ui:param name="dialogId" value="resultProcessedProductListModalPanel"/>
    <ui:param name="dataModel" value="#{processedProductDataModel}"/>
    <ui:param name="showMeasureUnit" value="false"/>
    <ui:define name="assignButton">
        <a4j:commandButton id="assignButton"
                           title="#{messages['Common.choose']}"
                           action="#{productionPlanningAction.selectResultProcessedProduct(dataItem)}"
                           image="/img/active.gif"
                           styleClass="select-image-middle"
                           ajaxSingle="true"
                           reRender="OutputProductionVoucherList"
                           oncomplete="Richfaces.hideModalPanel('resultProcessedProductListModalPanel');"
                           style="width:0.8em"/>

    </ui:define>
</s:decorate>

<rich:jQuery selector="#name" query="focus()" timing="onload"/>

</ui:define>
</ui:composition>
